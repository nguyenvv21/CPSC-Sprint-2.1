{% extends "layouts/base2.html" %}
{% block content %}

<div class="container">
  <div class="block-heading d-flex justify-content-between align-items-center">
    <div>
      <h1 class="fw-bold mb-2">Market Listings</h1>
      <a href="/welcomeinvestigator" style="color: black; text-decoration: none">All > </a>
      <a href="/marketlistings" class="fw-bold" style="color: black; text-decoration: none">Market Listings</a>
    </div>
    <div class="d-flex align-items-center">
      <button id="updateButton" class="btn btn-outline-dark me-3" style="border-width: 2px">
        Update Status
      </button>
    </div>
  </div>

  <form id="listings-form" method="POST" action="/updatestatus">
    <table class="table table-bordered">
      <thead class="table-dark">
        <tr>
          <th scope="col">Select</th>
          <th scope="col">Listing ID</th>
          <th scope="col">Listing Name</th>
          <th scope="col">Listing URL</th>
          <th scope="col">Product ID</th>
          <th scope="col">Listing Date</th>
        </tr>
      </thead>
      <tbody>
        {% for x in listings %}
        <tr>
          <td>
            <input type="checkbox" name="listings[]" value="{{ x.ListingID }}" class="form-check-input">
          </td>
          <td>{{ x.ListingID }}</td>
          <td>{{ x.ListingName }}</td>
          <td>{{ x.ListingURL }}</td>
          <td>{{ x.ProductID }}</td>
          <td>{{ x.ListingDateTime }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>
</div>

<script>
document.getElementById('updateButton').addEventListener('click', function() {
    var form = document.getElementById('listings-form');
    var checkboxes = form.querySelectorAll('input[name="listings[]"]:checked');
    
    if (checkboxes.length > 0) {
        form.submit();
    } else {
        alert('Please select at least one listing.');
    }
});
</script>

{% endblock content %}